# 📦【功能模块清单】- 用户管理功能

**项目名称**: 用户管理功能  
**创建时间**: 2025-10-31  
**维护者**: 开发工程师-小柳

---

## 📋 模块总览

| 模块名称         | 状态     | 优先级 | 进度 |
| ---------------- | -------- | ------ | ---- |
| 用户认证模块     | 📝 待开发 | ⭐⭐⭐⭐⭐  | 0%   |
| 用户信息管理模块 | 📝 待开发 | ⭐⭐⭐⭐   | 0%   |
| 权限管理模块     | 📝 待开发 | ⭐⭐⭐⭐   | 0%   |
| 数据库模块       | 📝 待开发 | ⭐⭐⭐⭐⭐  | 0%   |

---

## 模块1：用户认证模块

### 功能描述
实现用户注册、登录、JWT Token生成和验证等核心认证功能。

### 核心功能
- 用户注册（用户名、密码、邮箱）
- 用户登录（JWT认证）
- Token验证中间件
- 密码加密（bcrypt）
- Token刷新机制

### 核心文件
*待开发*

| 文件名             | 行数 | 作用          | 依赖           |
| ------------------ | ---- | ------------- | -------------- |
| auth-service.js    | -    | 认证服务      | jwt, bcrypt    |
| auth-middleware.js | -    | JWT验证中间件 | jwt            |
| user-model.js      | -    | 用户数据模型  | better-sqlite3 |

### 关键API
- `POST /api/auth/register` - 用户注册
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/refresh` - 刷新Token
- `POST /api/auth/logout` - 用户登出

### 测试状态
- ⏳ 单元测试（待编写）
- ⏳ 集成测试（待编写）
- ⏳ 安全测试（待编写）

### 已知问题
*暂无*

---

## 模块2：用户信息管理模块

### 功能描述
实现用户信息的查询、修改、删除等管理功能。

### 核心功能
- 查询当前用户信息
- 修改用户信息（邮箱、昵称等）
- 修改密码
- 用户列表查询（管理员）
- 删除用户（管理员）

### 核心文件
*待开发*

| 文件名             | 行数 | 作用           | 依赖            |
| ------------------ | ---- | -------------- | --------------- |
| user-service.js    | -    | 用户管理服务   | user-model.js   |
| user-controller.js | -    | 用户管理控制器 | user-service.js |

### 关键API
- `GET /api/users/me` - 获取当前用户信息
- `PUT /api/users/me` - 修改当前用户信息
- `PUT /api/users/me/password` - 修改密码
- `GET /api/users` - 获取用户列表（管理员）
- `DELETE /api/users/:id` - 删除用户（管理员）

### 测试状态
- ⏳ 单元测试（待编写）
- ⏳ 集成测试（待编写）

### 已知问题
*暂无*

---

## 模块3：权限管理模块

### 功能描述
实现基于角色的权限管理（RBAC），支持用户角色分配和权限验证。

### 核心功能
- 角色定义（管理员、普通用户、访客等）
- 权限定义（增删改查等操作权限）
- 用户角色分配
- 权限验证中间件
- 权限查询

### 核心文件
*待开发*

| 文件名                   | 行数 | 作用           | 依赖                  |
| ------------------------ | ---- | -------------- | --------------------- |
| permission-service.js    | -    | 权限管理服务   | -                     |
| permission-middleware.js | -    | 权限验证中间件 | permission-service.js |
| role-model.js            | -    | 角色数据模型   | better-sqlite3        |

### 关键API
- `GET /api/permissions/me` - 获取当前用户权限
- `POST /api/permissions/assign` - 分配权限（管理员）
- `GET /api/roles` - 获取角色列表
- `POST /api/roles` - 创建角色（管理员）

### 测试状态
- ⏳ 单元测试（待编写）
- ⏳ 集成测试（待编写）

### 已知问题
*暂无*

---

## 模块4：数据库模块

### 功能描述
设计和实现用户管理系统的数据库表结构，提供数据访问层。

### 核心功能
- 用户表（users）
- 角色表（roles）
- 权限表（permissions）
- 用户-角色关联表（user_roles）
- 角色-权限关联表（role_permissions）
- 数据库迁移脚本

### 数据库表设计

#### users表（用户表）
```sql
CREATE TABLE users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  username TEXT UNIQUE NOT NULL,
  password_hash TEXT NOT NULL,
  email TEXT UNIQUE NOT NULL,
  nickname TEXT,
  avatar TEXT,
  status TEXT DEFAULT 'active',  -- active, inactive, banned
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### roles表（角色表）
```sql
CREATE TABLE roles (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT UNIQUE NOT NULL,  -- admin, user, guest
  description TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### permissions表（权限表）
```sql
CREATE TABLE permissions (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT UNIQUE NOT NULL,  -- user:read, user:write, etc.
  description TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### user_roles表（用户-角色关联表）
```sql
CREATE TABLE user_roles (
  user_id INTEGER NOT NULL,
  role_id INTEGER NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (user_id, role_id),
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (role_id) REFERENCES roles(id)
);
```

#### role_permissions表（角色-权限关联表）
```sql
CREATE TABLE role_permissions (
  role_id INTEGER NOT NULL,
  permission_id INTEGER NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (role_id, permission_id),
  FOREIGN KEY (role_id) REFERENCES roles(id),
  FOREIGN KEY (permission_id) REFERENCES permissions(id)
);
```

### 核心文件
*待开发*

| 文件名        | 行数 | 作用             | 依赖           |
| ------------- | ---- | ---------------- | -------------- |
| db-init.js    | -    | 数据库初始化脚本 | better-sqlite3 |
| db-migrate.js | -    | 数据库迁移脚本   | -              |

### 测试状态
- ⏳ 数据库连接测试（待编写）
- ⏳ CRUD操作测试（待编写）
- ⏳ 性能测试（待编写）

### 已知问题
*暂无*

---

## 📊 模块依赖关系

```
数据库模块（基础层）
    ↓
用户认证模块 → 用户信息管理模块
    ↓              ↓
权限管理模块 ←-----┘
```

---

**最后更新**: 2025-10-31  
**维护者**: 开发工程师-小柳

