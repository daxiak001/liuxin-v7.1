{
  "📌文档说明": {
    "文档名称": "柳芯系统完整功能与规则文档",
    "文档版本": "v1.0.0",
    "生成时间": "2025-10-31T11:55:01.527Z",
    "文档用途": "让AI能够通过阅读这一个文档，快速理解柳芯系统的全部功能、规则、架构、已知问题，避免重复问题和死循环修复",
    "维护规则": "每次系统功能修改后，必须同步更新此文档",
    "AI阅读要求": "每次任务前，必须先读取此文档，了解系统全貌，查询是否有相关经验"
  },
  "🎯系统概览": {
    "系统名称": "柳芯 (LiuXin) AI助手增强系统",
    "版本": "v7.10.14",
    "最后更新": "2025-10-31",
    "系统架构": "MCP (Model Context Protocol) + 三层拦截器 + 数据库驱动",
    "核心文件": [
      "liuxin-mcp-server-unified.js (MCP服务器)",
      "ResponseInterceptor.js (响应拦截器)",
      "locks/LockManager.js (锁管理器)",
      "v7.3-core-logic.js (核心逻辑)",
      "fusion-phase2-memory-loader.js (记忆加载器)",
      "liuxin.db (SQLite数据库)"
    ],
    "数据库": "liuxin.db (SQLite3)",
    "部署模式": "本地模式 (Local Mode)",
    "主要功能": [
      "规则拦截与纠正",
      "团队模式与角色切换",
      "智能预加载与记忆管理",
      "统计与监控",
      "锁定与热重载",
      "归档与经验库"
    ]
  },
  "📖核心规则 (.cursorrules)": {
    "说明": "这些规则定义了AI的行为约束，必须100%遵守",
    "规则总数": 6,
    "规则列表": [
      {
        "id": "CORE-001",
        "name": "强制使用MCP工具",
        "priority": 1,
        "type": "CRITICAL_MUST",
        "rule": "必须使用mcp_前缀工具代替原生工具",
        "principle": "",
        "禁止行为": [],
        "历史教训": ""
      },
      {
        "id": "CORE-002",
        "name": "严禁越界修改代码",
        "priority": 1,
        "type": "CRITICAL_MUST",
        "rule": "只修改用户明确指定的代码，严禁连带修改其他功能",
        "principle": "修改B功能时，A/C/D功能的代码一个字符都不能动",
        "禁止行为": [
          "修改其他函数/方法（即使在同一文件）",
          "批量修改多个规则/记录（除非明确要求）",
          "顺便优化其他代码"
        ],
        "历史教训": "upgrade-all-rules-to-block.js事件：本应只修复一个规则，却批量修改了所有规则，导致系统完全失效"
      },
      {
        "id": "CORE-003",
        "name": "禁止降级修复",
        "priority": 2,
        "type": "MUST",
        "rule": "修复问题时找到根因，禁止用低级方案替代",
        "principle": "找到问题的根本原因，直接修复，保持原方案不变",
        "禁止行为": [
          "用低级方案替代高级方案（如：MCP拦截失效→改用.cursorrules）",
          "削弱功能（如：Response拦截器不工作→删除它）",
          "简化逻辑（如：复杂检测有bug→简化为简单判断）",
          "改变架构方案（如：架构A有bug→换成架构B）"
        ],
        "历史教训": "多次尝试用.cursorrules替代MCP拦截器，但这是降级，没有解决根本问题。正确方案是找到RULE-002是block，改回warn，MCP恢复正常"
      },
      {
        "id": "CORE-004",
        "name": "强制项目归档与记忆系统",
        "priority": 1,
        "type": "CRITICAL_MUST",
        "rule": "每次任务/对话/开发/修复后，自动维护项目5文件体系 + 对话存档 + 经验记录",
        "principle": "",
        "禁止行为": [],
        "历史教训": ""
      },
      {
        "id": "CORE-005",
        "name": "禁止分裂系统",
        "priority": 2,
        "type": "MUST",
        "rule": "禁止创建新的系统文件夹、数据库文件",
        "principle": "",
        "禁止行为": [
          "创建新文件夹（如：柳芯v7.2、柳芯v8.0、新版本、副本等）",
          "创建新数据库文件（如：liuxin-v2.db、liuxin-new.db等）",
          "创建新的MCP服务器文件"
        ],
        "历史教训": ""
      },
      {
        "id": "CORE-006",
        "name": "需求复述与执行计划（强制执行）",
        "priority": 1,
        "type": "CRITICAL_MUST",
        "rule": "收到用户任务后，第一件事：必须先复述用户需求，再提出执行计划，最后询问确认",
        "principle": "",
        "禁止行为": [],
        "历史教训": ""
      }
    ]
  },
  "📊数据库规则": {
    "说明": "这些规则定义了MCP拦截器的行为，分为Pre/Post/Response三个阶段",
    "规则总数": 72,
    "启用规则数": 70,
    "禁用规则数": 2,
    "规则分类": {
      "团队模式": 0,
      "代码质量": 0,
      "响应质量": 1,
      "系统保护": 0
    },
    "规则列表": [
      {
        "规则代码": "RULE-000",
        "规则名称": "强制读取系统总览",
        "描述": "每次对话开始前2次工具调用必须读取系统总览和记忆系统",
        "拦截阶段": "pre_execution",
        "拦截动作": "warn",
        "是否启用": "是",
        "优先级": 100,
        "分类": "core"
      },
      {
        "规则代码": "SYS-UPGRADE-001",
        "规则名称": "系统升级前必须评估",
        "描述": "系统升级/优化/修复前必须先评估现有系统和新方案，对比分析后获得用户确认才能修改",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "否",
        "优先级": 99,
        "分类": "sys"
      },
      {
        "规则代码": "IR-001",
        "规则名称": "禁止分裂系统",
        "描述": "禁止创建新的系统文件夹、数据库文件，防止系统分裂",
        "拦截阶段": "pre_execution",
        "拦截动作": "warn",
        "是否启用": "是",
        "优先级": 98,
        "分类": "iron"
      },
      {
        "规则代码": "IR-002",
        "规则名称": "禁止删除历史",
        "描述": "禁止删除历史记录、备份文件",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 96,
        "分类": "iron"
      },
      {
        "规则代码": "CLOUD-FORCE-RULES-011",
        "规则名称": "团队模式强制",
        "描述": "每次回复必须使用角色，必须调用team-mode-enhanced",
        "拦截阶段": "pre_execution",
        "拦截动作": "warn",
        "是否启用": "是",
        "优先级": 95,
        "分类": "cloud"
      },
      {
        "规则代码": "CMD-NON-INTERACTIVE-001",
        "规则名称": "命令必须非交互式执行",
        "描述": "检测run_terminal_cmd是否包含需要用户交互的命令，如果是则必须添加非交互参数",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 95,
        "分类": "tool"
      },
      {
        "规则代码": "RULE-001",
        "规则名称": "必须调用团队模式",
        "描述": "每次回复前必须执行团队模式API获取角色身份",
        "拦截阶段": "all",
        "拦截动作": "warn",
        "是否启用": "是",
        "优先级": 95,
        "分类": "core"
      },
      {
        "规则代码": "RULE-002",
        "规则名称": "必须复述用户需求",
        "描述": "每次回复前必须复述用户需求，确保理解一致",
        "拦截阶段": "response",
        "拦截动作": "warn",
        "是否启用": "是",
        "优先级": 95,
        "分类": "core"
      },
      {
        "规则代码": "SYS-001",
        "规则名称": "系统文件保护",
        "描述": "禁止删除系统核心文件，修改前必须备份",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 95,
        "分类": "sys"
      },
      {
        "规则代码": "SYS-003",
        "规则名称": "服务器安全",
        "描述": "命令执行必须验证，禁止执行危险命令",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 95,
        "分类": "sys"
      },
      {
        "规则代码": "IR-003",
        "规则名称": "强制读取记忆",
        "描述": "每次对话必须读取📚AI核心记忆.json",
        "拦截阶段": "pre_execution",
        "拦截动作": "warn",
        "是否启用": "是",
        "优先级": 94,
        "分类": "iron"
      },
      {
        "规则代码": "CMD-BACKGROUND-001",
        "规则名称": "长时间命令必须后台运行",
        "描述": "检测run_terminal_cmd是否为长时间运行的命令，如果是则必须设置is_background=true",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 93,
        "分类": "tool"
      },
      {
        "规则代码": "AUTO-READ-IMPORTANT-001",
        "规则名称": "自动读取重要文件",
        "描述": "对话开始时必须读取AI核心记忆和系统总览",
        "拦截阶段": "pre_execution",
        "拦截动作": "warn",
        "是否启用": "是",
        "优先级": 92,
        "分类": "anti"
      },
      {
        "规则代码": "RULE-008",
        "规则名称": "强制同步系统总览",
        "描述": "每次修改系统后必须更新系统总览文件",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 92,
        "分类": "core"
      },
      {
        "规则代码": "CLOUD-FORCE-RULES-005",
        "规则名称": "AI行为控制",
        "描述": "必须遵守所有规则，违规必须记录",
        "拦截阶段": "all",
        "拦截动作": "warn",
        "是否启用": "是",
        "优先级": 90,
        "分类": "cloud"
      },
      {
        "规则代码": "CLOUD-FORCE-RULES-008",
        "规则名称": "数据完整性保护",
        "描述": "数据库操作必须验证，必须检查数据一致性",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 90,
        "分类": "cloud"
      },
      {
        "规则代码": "DATA-002-V2",
        "规则名称": "数据迁移可回滚",
        "描述": "数据迁移必须可回滚",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 90,
        "分类": "other"
      },
      {
        "规则代码": "ROLE-001",
        "规则名称": "使用5个角色之一",
        "描述": "必须使用5个角色之一",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 90,
        "分类": "other"
      },
      {
        "规则代码": "RULE-004",
        "规则名称": "命令执行前必须验证",
        "描述": "执行run_terminal_cmd前必须调用command-validate验证",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 90,
        "分类": "core"
      },
      {
        "规则代码": "RULE-007",
        "规则名称": "每次回复必须显示统计",
        "描述": "每次回复结尾必须显示触发规则和违规统计",
        "拦截阶段": "response",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 90,
        "分类": "core"
      },
      {
        "规则代码": "IR-005",
        "规则名称": "强制显示统计",
        "描述": "铁律：每次回复必须显示统计，格式固定",
        "拦截阶段": "response",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 89,
        "分类": "iron"
      },
      {
        "规则代码": "CLOUD-FORCE-RULES-004",
        "规则名称": "强制项目5文件体系",
        "描述": "开发/调试/修复Bug前必须执行项目5文件体系检查",
        "拦截阶段": "response",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 88,
        "分类": "cloud"
      },
      {
        "规则代码": "CLOUD-FORCE-RULES-012",
        "规则名称": "GUI测试强制",
        "描述": "GUI功能必须真实测试，必须完成三阶段验证",
        "拦截阶段": "mid_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 88,
        "分类": "cloud"
      },
      {
        "规则代码": "CMD-FORMAT-CHECK-001",
        "规则名称": "命令格式检查",
        "描述": "执行命令前必须检查格式，调用command-validate API",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 88,
        "分类": "anti"
      },
      {
        "规则代码": "RULE-006",
        "规则名称": "GUI功能必须真实测试",
        "描述": "创建GUI界面时必须调用gui-test-enforce强制测试",
        "拦截阶段": "mid_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 88,
        "分类": "core"
      },
      {
        "规则代码": "ANTI-DOWNGRADE-001",
        "规则名称": "禁止降级修复",
        "描述": "",
        "拦截阶段": "all",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 85,
        "分类": "anti"
      },
      {
        "规则代码": "ANTI-LOCAL-001",
        "规则名称": "禁止本地规则替代",
        "描述": "禁止使用本地规则替代云端规则",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 85,
        "分类": "anti"
      },
      {
        "规则代码": "CLOUD-FORCE-RULES-007",
        "规则名称": "系统总览维护",
        "描述": "重大修改必须更新系统总览，必须保持总览文件最新",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "否",
        "优先级": 85,
        "分类": "cloud"
      },
      {
        "规则代码": "DATA-001",
        "规则名称": "数据库事务",
        "描述": "数据库操作必须使用事务",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 85,
        "分类": "other"
      },
      {
        "规则代码": "MEM-001",
        "规则名称": "记忆管理规范",
        "描述": "重要对话必须记录到记忆系统",
        "拦截阶段": "post_execution",
        "拦截动作": "warn",
        "是否启用": "是",
        "优先级": 85,
        "分类": "mcp"
      },
      {
        "规则代码": "ROLE-FORMAT-001",
        "规则名称": "回复必须使用角色格式",
        "描述": "每次回复必须使用\"作为【角色名】\"的格式",
        "拦截阶段": "response",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 85,
        "分类": "role"
      },
      {
        "规则代码": "RULE-005",
        "规则名称": "代码修改前必须检查范围",
        "描述": "修改多个文件前必须调用code-scope-check检查范围",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 85,
        "分类": "core"
      },
      {
        "规则代码": "SYS-002",
        "规则名称": "配置文件管理",
        "描述": "配置修改必须验证，必须保留旧配置",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 85,
        "分类": "sys"
      },
      {
        "规则代码": "CODE-SCOPE-001",
        "规则名称": "代码范围检查",
        "描述": "修改>3个文件时必须调用code-scope-check，说明修改原因",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 82,
        "分类": "anti"
      },
      {
        "规则代码": "CLOUD-FORCE-RULES-002",
        "规则名称": "测试验证强制",
        "描述": "代码修改必须测试，必须提供测试结果",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 80,
        "分类": "cloud"
      },
      {
        "规则代码": "CLOUD-FORCE-RULES-009",
        "规则名称": "任务自检机制",
        "描述": "任务完成前必须自检，必须确认所有步骤完成",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 80,
        "分类": "cloud"
      },
      {
        "规则代码": "IR-006",
        "规则名称": "智能确认机制 - 多需求检测",
        "描述": "当检测到用户需求≥3项时，强制要求AI先复述并等待用户确认后再执行",
        "拦截阶段": "response",
        "拦截动作": "warn",
        "是否启用": "是",
        "优先级": 80,
        "分类": "response_quality"
      },
      {
        "规则代码": "ROLE-005",
        "规则名称": "角色能力范围明确",
        "描述": "确保AI只执行所分配角色的职责范围内的工作",
        "拦截阶段": "mid_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 80,
        "分类": "role"
      },
      {
        "规则代码": "RULE-003",
        "规则名称": "场景分析与规则触发",
        "描述": "对于复杂任务应该执行场景分析",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 80,
        "分类": "core"
      },
      {
        "规则代码": "SMART-UPGRADE-001",
        "规则名称": "智能升级规范",
        "描述": "升级前必须备份，必须测试升级结果",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 80,
        "分类": "sys"
      },
      {
        "规则代码": "SYS-011",
        "规则名称": "服务器状态监控",
        "描述": "重要操作前检查服务器状态，发现异常必须报告",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 80,
        "分类": "sys"
      },
      {
        "规则代码": "TEST-002-V2",
        "规则名称": "关键功能手动测试",
        "描述": "关键功能必须手动测试",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 80,
        "分类": "other"
      },
      {
        "规则代码": "CLOUD-FORCE-RULES-003",
        "规则名称": "开发流程规范",
        "描述": "开发流程规范：需求→设计→开发→测试，每步必须有输出",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 75,
        "分类": "cloud"
      },
      {
        "规则代码": "CLOUD-FORCE-RULES-006",
        "规则名称": "版本管理规范",
        "描述": "重要修改必须备份，必须记录版本号",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 75,
        "分类": "cloud"
      },
      {
        "规则代码": "DEV-COMPLETE-CHECK-001",
        "规则名称": "开发完成度检查",
        "描述": "开发任务完成前必须检查代码完整性、错误处理、文档完整性",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 75,
        "分类": "role"
      },
      {
        "规则代码": "DIAG-001",
        "规则名称": "三维度系统检查",
        "描述": "系统检查必须三维度（本地+云端+文档）",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 75,
        "分类": "other"
      },
      {
        "规则代码": "IR-040-V2",
        "规则名称": "数据备份定期执行",
        "描述": "重要数据操作前必须备份",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 75,
        "分类": "iron"
      },
      {
        "规则代码": "IR-048",
        "规则名称": "项目管理规范",
        "描述": "项目管理规范",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 75,
        "分类": "other"
      },
      {
        "规则代码": "IR-108",
        "规则名称": "使用合适的工具",
        "描述": "文件操作使用专用工具，禁止用cat/echo等命令操作文件",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 75,
        "分类": "tool"
      },
      {
        "规则代码": "MCP-001",
        "规则名称": "MCP工具优先使用",
        "描述": "当有MCP工具可用时优先使用MCP工具而非自己实现",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 75,
        "分类": "mcp"
      },
      {
        "规则代码": "RULE-CONFLICT-CHECK-001",
        "规则名称": "规则冲突检查",
        "描述": "发现规则冲突必须报告，必须建议解决方案",
        "拦截阶段": "pre_execution",
        "拦截动作": "warn",
        "是否启用": "是",
        "优先级": 75,
        "分类": "sys"
      },
      {
        "规则代码": "TEST-001",
        "规则名称": "测试覆盖率要求",
        "描述": "测试覆盖率必须>80%",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 75,
        "分类": "other"
      },
      {
        "规则代码": "CLOUD-FORCE-RULES-010",
        "规则名称": "多窗口同步",
        "描述": "多窗口操作必须同步状态，必须避免数据冲突",
        "拦截阶段": "post_execution",
        "拦截动作": "warn",
        "是否启用": "是",
        "优先级": 70,
        "分类": "cloud"
      },
      {
        "规则代码": "DEV-STANDARD-001",
        "规则名称": "开发工程师规范",
        "描述": "作为开发工程师-小柳时必须遵守代码规范，添加注释，考虑错误处理",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 70,
        "分类": "role"
      },
      {
        "规则代码": "DOC-001",
        "规则名称": "文档必须完整",
        "描述": "创建功能必须附带文档，包含使用示例",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 70,
        "分类": "tool"
      },
      {
        "规则代码": "DOC-002-V2",
        "规则名称": "API文档完整",
        "描述": "API文档必须完整",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 70,
        "分类": "other"
      },
      {
        "规则代码": "GUI-SELF-CHECK-001",
        "规则名称": "GUI设计师自检",
        "描述": "作为GUI设计师-小美时必须提供界面原型或描述，说明设计理由",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 70,
        "分类": "role"
      },
      {
        "规则代码": "IR-042",
        "规则名称": "任务管理规范",
        "描述": "复杂任务必须使用TODO管理",
        "拦截阶段": "all",
        "拦截动作": "warn",
        "是否启用": "是",
        "优先级": 70,
        "分类": "iron"
      },
      {
        "规则代码": "MCP-003",
        "规则名称": "MCP错误必须处理",
        "描述": "MCP调用失败必须捕获错误并向用户说明",
        "拦截阶段": "mid_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 70,
        "分类": "mcp"
      },
      {
        "规则代码": "ROLE-004",
        "规则名称": "角色切换有理由",
        "描述": "角色切换必须有理由",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 70,
        "分类": "other"
      },
      {
        "规则代码": "SYS-004",
        "规则名称": "资源管理",
        "描述": "必须检查磁盘空间，必须清理临时文件",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 70,
        "分类": "sys"
      },
      {
        "规则代码": "TEST-PROJECT-MEMORY-001",
        "规则名称": "测试经理项目记忆",
        "描述": "作为测试与质量经理-小观时必须记录测试结果，提供测试覆盖率",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 70,
        "分类": "role"
      },
      {
        "规则代码": "TODO-001",
        "规则名称": "复杂任务必须创建TODO",
        "描述": ">3步骤的任务必须创建TODO列表，标记任务状态",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 70,
        "分类": "tool"
      },
      {
        "规则代码": "USER-MGR-ENHANCE-001",
        "规则名称": "用户经理增强",
        "描述": "作为用户经理-小户时必须深入分析用户需求，提出3个以上解决方案",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 70,
        "分类": "role"
      },
      {
        "规则代码": "VERSION-001",
        "规则名称": "版本修改记录",
        "描述": "重大版本修改必须记录",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 70,
        "分类": "other"
      },
      {
        "规则代码": "CLOUD-FORCE-RULES-001",
        "规则名称": "文档格式规范",
        "描述": "Markdown文件必须有标题，代码必须有语法高亮标记",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 65,
        "分类": "cloud"
      },
      {
        "规则代码": "DIALOG-001",
        "规则名称": "对话必须有结论",
        "描述": "每次回复必须有明确结论，告知下一步行动",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 65,
        "分类": "tool"
      },
      {
        "规则代码": "IR-112",
        "规则名称": "工具调用必须说明",
        "描述": "调用工具前说明原因，调用后说明结果",
        "拦截阶段": "pre_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 65,
        "分类": "tool"
      },
      {
        "规则代码": "MCP-002",
        "规则名称": "MCP调用必须记录",
        "描述": "每次MCP调用必须记录到数据库",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 65,
        "分类": "mcp"
      },
      {
        "规则代码": "SYS-012",
        "规则名称": "日志记录规范",
        "描述": "重要操作必须记录日志，错误必须详细记录",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 65,
        "分类": "sys"
      },
      {
        "规则代码": "IR-109",
        "规则名称": "保持对话连贯性",
        "描述": "必须引用用户之前的消息，保持上下文一致",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 60,
        "分类": "tool"
      },
      {
        "规则代码": "IR-200",
        "规则名称": "对话日志记录",
        "描述": "重要对话必须记录到数据库，记录用户需求和AI决策",
        "拦截阶段": "post_execution",
        "拦截动作": "block",
        "是否启用": "是",
        "优先级": 60,
        "分类": "tool"
      }
    ]
  },
  "👥团队模式角色": {
    "说明": "柳芯支持多个角色，根据用户输入自动切换",
    "角色总数": 5,
    "角色列表": [
      {
        "角色ID": "AI-1",
        "中文名称": "用户经理",
        "英文名称": "Customer Requirements Manager",
        "描述": "负责需求收集、分析、补全和文档编写，是客户与团队之间的桥梁",
        "分类": "需求管理"
      },
      {
        "角色ID": "AI-4",
        "中文名称": "开发工程师",
        "英文名称": "Full-stack Developer",
        "描述": "负责技术架构设计、代码开发、数据库设计和性能优化，是技术实现的核心",
        "分类": "技术开发"
      },
      {
        "角色ID": "AI-2",
        "中文名称": "产品经理",
        "英文名称": "Product Manager",
        "描述": "负责产品规划、功能定义、优先级决策和PRD编写，是产品战略的决策者",
        "分类": "产品管理"
      },
      {
        "角色ID": "AI-5",
        "中文名称": "测试与质量经理",
        "英文名称": "QA Manager",
        "描述": "负责测试计划、用例设计、缺陷管理和质量保证，是质量的守护者",
        "分类": "质量保证"
      },
      {
        "角色ID": "AI-3",
        "中文名称": "GUI设计师",
        "英文名称": "UI/UX Designer",
        "描述": "负责用户界面设计、交互设计和用户体验优化，创造美观易用的界面",
        "分类": "界面设计"
      }
    ]
  },
  "🔒模块锁定状态": {
    "说明": "锁定的模块不可修改，除非用户明确解锁",
    "模块总数": 5,
    "已锁定模块数": 3,
    "未锁定模块数": 2,
    "模块列表": [
      {
        "模块标识": "statistics",
        "模块名称": "统计模块",
        "是否锁定": "是",
        "锁定时间": "2025-10-31T10:30:00.000Z",
        "锁定原因": "用户明确要求终极锁定：统计功能反复出现问题，必须彻底锁死，不允许再出现未锁定完全导致无法使用的情况",
        "受保护文件数": 10,
        "受保护函数数": 10,
        "受保护规则数": 2
      },
      {
        "模块标识": "team_mode",
        "模块名称": "团队模式",
        "是否锁定": "否",
        "锁定时间": "",
        "锁定原因": "",
        "受保护文件数": 2,
        "受保护函数数": 0,
        "受保护规则数": 3
      },
      {
        "模块标识": "rephrase",
        "模块名称": "复述检测",
        "是否锁定": "是",
        "锁定时间": "2025-10-28T07:08:19.584Z",
        "锁定原因": "用户要求锁定复述模块，防止修改、添加、删除",
        "受保护文件数": 1,
        "受保护函数数": 2,
        "受保护规则数": 1
      },
      {
        "模块标识": "mcp_interceptor",
        "模块名称": "MCP拦截器核心",
        "是否锁定": "否",
        "锁定时间": "",
        "锁定原因": "",
        "受保护文件数": 1,
        "受保护函数数": 3,
        "受保护规则数": 0
      },
      {
        "模块标识": "lock_manager",
        "模块名称": "锁管理器自身",
        "是否锁定": "是",
        "锁定时间": "2025-10-29T02:50:00.000Z",
        "锁定原因": "热重载功能已完成，防止被破坏",
        "受保护文件数": 2,
        "受保护函数数": 10,
        "受保护规则数": 0
      }
    ]
  },
  "💡技能与经验": {
    "说明": "系统预加载的技能和经验数据",
    "技能总数": 124,
    "经验总数": 42,
    "Top20技能": [
      {
        "技能ID": "2",
        "技能名称": "JavaScript编程",
        "分类": "开发",
        "描述": "精通JavaScript及ES6+特性",
        "等级": 5
      },
      {
        "技能ID": "13",
        "技能名称": "脚本开发",
        "分类": "开发",
        "描述": "自动化脚本编写",
        "等级": 5
      },
      {
        "技能ID": "1",
        "技能名称": "Node.js开发",
        "分类": "开发",
        "描述": "熟练使用Node.js进行后端开发",
        "等级": 5
      },
      {
        "技能ID": "33",
        "技能名称": "方案设计",
        "分类": "产品",
        "描述": "产品方案设计",
        "等级": 5
      },
      {
        "技能ID": "42",
        "技能名称": "用户需求收集",
        "分类": "需求",
        "描述": "用户需求收集",
        "等级": 5
      },
      {
        "技能ID": "32",
        "技能名称": "需求分析",
        "分类": "产品",
        "描述": "用户需求分析",
        "等级": 5
      },
      {
        "技能ID": "43",
        "技能名称": "用户反馈处理",
        "分类": "需求",
        "描述": "用户反馈处理",
        "等级": 5
      },
      {
        "技能ID": "10",
        "技能名称": "代码调试",
        "分类": "开发",
        "描述": "系统问题诊断与调试",
        "等级": 5
      },
      {
        "技能ID": "23",
        "技能名称": "质量验证",
        "分类": "测试",
        "描述": "质量标准验证",
        "等级": 5
      },
      {
        "技能ID": "40",
        "技能名称": "沟通协调",
        "分类": "管理",
        "描述": "团队沟通协调",
        "等级": 5
      },
      {
        "技能ID": "44",
        "技能名称": "需求确认",
        "分类": "需求",
        "描述": "需求确认与澄清",
        "等级": 5
      },
      {
        "技能ID": "52",
        "技能名称": "UI设计",
        "分类": "设计",
        "描述": "用户界面设计",
        "等级": 5
      },
      {
        "技能ID": "28",
        "技能名称": "报告编写",
        "分类": "文档",
        "描述": "测试报告撰写",
        "等级": 5
      },
      {
        "技能ID": "49",
        "技能名称": "用户沟通",
        "分类": "沟通",
        "描述": "用户沟通技巧",
        "等级": 5
      },
      {
        "技能ID": "3",
        "技能名称": "SQLite数据库",
        "分类": "开发",
        "描述": "熟练使用SQLite进行数据管理",
        "等级": 4
      },
      {
        "技能ID": "22",
        "技能名称": "测试设计",
        "分类": "测试",
        "描述": "测试用例设计",
        "等级": 5
      },
      {
        "技能ID": "9",
        "技能名称": "API设计",
        "分类": "开发",
        "描述": "RESTful API设计与实现",
        "等级": 4
      },
      {
        "技能ID": "25",
        "技能名称": "Bug分析",
        "分类": "测试",
        "描述": "Bug分析与追踪",
        "等级": 5
      },
      {
        "技能ID": "39",
        "技能名称": "项目管理",
        "分类": "管理",
        "描述": "项目进度管理",
        "等级": 4
      },
      {
        "技能ID": "38",
        "技能名称": "文档管理",
        "分类": "文档",
        "描述": "需求文档管理",
        "等级": 4
      }
    ],
    "Top20经验": [
      {
        "经验ID": 1,
        "经验标题": "系统整合经验-防分裂机制",
        "经验内容": "多系统并存会导致分裂，需要：1)唯一性检测守护进程 2)自动清理脚本 3)统一入口控制。实用主义策略：核心功能整合+文件系统保留。...",
        "分类": "系统架构",
        "标签": "系统整合,防分裂,实用主义"
      },
      {
        "经验ID": 23,
        "经验标题": "MCP拦截器架构限制-Cursor内置工具无法拦截",
        "经验内容": "MCP拦截器无法拦截Cursor内置工具（write/search_replace/run_terminal_cmd）的根本原因：Cursor内置工具不经过MCP协议，直接执行，完全绕过MCP桥接器。...",
        "分类": "MCP架构",
        "标签": "MCP,拦截器,Cursor内置工具,架构限制,HTTP服务器"
      },
      {
        "经验ID": 2,
        "经验标题": "MCP工具开发经验-云端模式",
        "经验内容": "禁止本地部署！必须使用云端模式(43.142.176.53:3002)。MCP客户端仅作桥梁，所有逻辑在云端执行。...",
        "分类": "MCP开发",
        "标签": "MCP,云端模式,禁止本地"
      },
      {
        "经验ID": 3,
        "经验标题": "规则执行率提升经验",
        "经验内容": "规则越少执行率越高。6-8条简单规则可达95%+执行率。铁律必须置顶，使用4层检测机制(关键词+语义+上下文+行为)。...",
        "分类": "规则设计",
        "标签": "规则执行,铁律,检测机制"
      },
      {
        "经验ID": 4,
        "经验标题": "技能库扩展最佳实践",
        "经验内容": "在扩展技能库时，应先检查现有数据再决定策略。采用方案B：合并保留而非清空替换，可以保留原有经验同时获得新功能。关键步骤：1)备份现有数据 2)提供多个方案供选择 3)验证合并结果 4)确认数据完整性。...",
        "分类": "数据库优化",
        "标签": "JSON:[技能库,数据迁移,合并策略,备份恢复]"
      },
      {
        "经验ID": 5,
        "经验标题": "外键约束处理技巧",
        "经验内容": "遇到外键约束导致数据插入失败时，可临时禁用外键约束完成操作：PRAGMA foreign_keys=OFF; INSERT...; PRAGMA foreign_keys=ON;。但必须注意：1)操作...",
        "分类": "数据库技术",
        "标签": "JSON:[SQLite,外键约束,数据迁移,问题解决]"
      },
      {
        "经验ID": 6,
        "经验标题": "4层混合索引架构设计",
        "经验内容": "针对技能库设计的4层混合索引：L1分类索引(Hash)用于快速分类查询、L2全文索引(FTS5)用于语义搜索、L3组合索引(Composite)用于多条件筛选、L4频率索引(Sorted)用于热门推荐...",
        "分类": "性能优化",
        "标签": "JSON:[索引设计,数据库优化,查询性能,架构设计]"
      },
      {
        "经验ID": 7,
        "经验标题": "FTS5中文搜索混合策略",
        "经验内容": "SQLite FTS5默认不支持中文分词，导致中文关键词搜索失败。解决方案：采用混合搜索策略 - FTS5提供高性能索引结构，LIKE提供备用搜索保证准确率。未来可集成jieba等中文分词库进一步优化...",
        "分类": "全文搜索",
        "标签": "JSON:[FTS5,中文搜索,混合策略,准确率优化]"
      },
      {
        "经验ID": 8,
        "经验标题": "FTS5自动同步触发器设计",
        "经验内容": "为FTS虚拟表创建3个触发器实现零人工维护：INSERT触发器(插入时同步)、UPDATE触发器(更新时同步)、DELETE触发器(删除时同步)。触发器确保数据一致性100%，实时同步无延迟。代码模式...",
        "分类": "数据库自动化",
        "标签": "JSON:[FTS5,触发器,自动同步,数据一致性]"
      },
      {
        "经验ID": 9,
        "经验标题": "多系统整合防分裂机制",
        "经验内容": "整合多个独立系统时，关键是建立统一的数据模型和接口规范。采用渐进式整合策略：1)先整合最相似的2个系统 2)建立统一接口层 3)逐步整合其他系统 4)持续监控分裂风险。通过此方法成功整合7个系统，避免...",
        "分类": "系统架构",
        "标签": "JSON:[系统整合,防分裂,接口设计,渐进式]"
      },
      {
        "经验ID": 10,
        "经验标题": "MCP工具云端模式开发经验",
        "经验内容": "MCP工具应采用纯云端模式避免本地依赖：1)所有API调用指向云端 2)避免本地数据库 3)使用SSH远程执行 4)统一配置管理。云端模式优势：零安装成本、统一维护、即时更新。实践证明可将安装成功率从...",
        "分类": "MCP开发",
        "标签": "JSON:[MCP,云端模式,远程执行,API设计]"
      },
      {
        "经验ID": 11,
        "经验标题": "规则执行率提升策略",
        "经验内容": "Cursor规则执行率优化的3个关键：1)规则数量控制在30条以内 2)使用分层管理(MCP+云端) 3)关键规则使用强制执行格式。实测表明：30条规则执行率可达88-92%，超过50条会降至60%以...",
        "分类": "规则引擎",
        "标签": "JSON:[规则管理,执行率,Cursor,优化策略]"
      },
      {
        "经验ID": 12,
        "经验标题": "铁律规则设计模式",
        "经验内容": "铁律规则设计的4个要素：1)明确触发条件(关键词) 2)强制执行要求(必须做什么) 3)禁止操作清单(绝对不能做什么) 4)违规处理机制。格式：### 铁律XXX: [名称] **触发条件**: .....",
        "分类": "规则设计",
        "标签": "JSON:[铁律,规则设计,触发条件,执行率]"
      },
      {
        "经验ID": 13,
        "经验标题": "需求确认规则实施技巧",
        "经验内容": "包含分析、查看、检查、开发、修改等关键词时必须先确认需求：1)使用[角色-姓名]格式 2)复述用户需求 3)列出执行计划 4)等待用户确认。此规则可避免80%的无效开发，提升用户满意度。关键是识别关键...",
        "分类": "流程规范",
        "标签": "JSON:[需求确认,用户沟通,关键词识别,流程控制]"
      },
      {
        "经验ID": 14,
        "经验标题": "5维度全面测试框架",
        "经验内容": "完整的测试应覆盖5个维度：1)数据完整性验证(总数、分类、完整性) 2)索引有效性验证(数量、使用率) 3)功能验证(FTS、触发器) 4)查询准确率测试(多场景) 5)目标达成验证。此框架在Week...",
        "分类": "测试方法",
        "标签": "JSON:[测试框架,质量保证,全面验证,准确率]"
      },
      {
        "经验ID": 15,
        "经验标题": "真实数据测试的重要性",
        "经验内容": "测试必须使用真实数据而非模拟数据：1)连接真实云端环境 2)使用实际生产数据 3)真实网络环境 4)完整业务场景。真实测试可发现80%的隐藏问题。Week1测试中通过真实数据发现了FTS5中文搜索问题...",
        "分类": "测试策略",
        "标签": "JSON:[真实测试,生产环境,问题发现,质量保证]"
      },
      {
        "经验ID": 16,
        "经验标题": "进度表实时更新机制",
        "经验内容": "项目进度表应实时更新并包含：1)任务完成状态 2)关键指标追踪 3)成功标准达成 4)决策记录 5)沟通记录。每完成一个任务立即更新。实践表明实时更新可提升团队透明度，减少50%的重复沟通。...",
        "分类": "项目管理",
        "标签": "JSON:[进度管理,透明度,团队协作,沟通效率]"
      },
      {
        "经验ID": 17,
        "经验标题": "完成报告生成规范",
        "经验内容": "每个任务完成后生成包含：1)执行摘要 2)关键成果 3)技术亮点 4)遇到的挑战 5)解决方案 6)下一步行动。报告应清晰、具体、可追溯。Week1生成的6个完成报告为后续工作提供了完整参考。...",
        "分类": "文档规范",
        "标签": "JSON:[完成报告,文档化,知识沉淀,可追溯性]"
      },
      {
        "经验ID": 18,
        "经验标题": "敏捷应对问题解决法",
        "经验内容": "遇到问题时的4步快速应对：1)快速发现问题(通过测试验证) 2)深度分析根因(查日志、检查数据) 3)提出多个方案(至少3个) 4)验证效果(真实测试)。Week1中通过此方法解决了技能合并、外键约束...",
        "分类": "问题解决",
        "标签": "JSON:[敏捷开发,根因分析,方案对比,快速迭代]"
      },
      {
        "经验ID": 19,
        "经验标题": "轻量级方案vs重型方案选择",
        "经验内容": "方案选择的3个维度评估：1)可行性(技术实现难度) 2)成本(开发成本+维护成本) 3)执行率(实际效果)。轻量级方案优势：95%可行性、bash成本、88-92%执行率。重型方案风险：70%可行性、...",
        "分类": "方案选择",
        "标签": "JSON:[架构决策,成本效益,风险评估,可行性分析]"
      }
    ]
  },
  "📊监控点位": {
    "说明": "系统中所有可监控的触发点（v7.10.14已修正并扩充）",
    "总监控点位": 350,
    "分类统计": {
      "规则拦截": 70,
      "技能监测": 124,
      "经验监测": 42,
      "场景映射": 25,
      "MCP工具": 5,
      "函数执行": 1,
      "全局标志": 10,
      "违规检测": 31,
      "上下文分析": 20,
      "锁定管理": 22
    },
    "修正说明": "v7.10.14：删除重复计算的'其他规则'分类（106个），更新违规检测94→13→31、上下文分析19→20、锁定管理39→22",
    "改进说明": "v7.10.14改进：违规检测规则库从13条扩充到31条（+138%），新增Git、sudo、系统文件、网络、数据库保护等18条规则"
  },
  "🛠️核心功能说明": {
    "说明": "柳芯系统的8大核心功能",
    "功能总数": 8,
    "功能列表": [
      {
        "name": "规则拦截系统",
        "description": "三层拦截器（Pre/Post/Response）拦截工具调用，根据规则进行纠正",
        "key_files": [
          "liuxin-mcp-server-unified.js",
          "ResponseInterceptor.js"
        ],
        "key_rules": [
          "RULE-001",
          "RULE-002",
          "RULE-003",
          "RULE-004",
          "RULE-005"
        ],
        "status": "正常",
        "注意事项": "不要修改拦截逻辑，会导致死循环"
      },
      {
        "name": "团队模式",
        "description": "根据用户输入智能分配角色（用户经理、开发工程师、GUI设计师、产品经理、测试经理）",
        "key_files": [
          "v7.3-core-logic.js",
          "liuxin-mcp-server-unified.js"
        ],
        "key_rules": [
          "RULE-001",
          "ROLE-FORMAT-001"
        ],
        "status": "正常",
        "注意事项": "SmartPreloader.analyzeRole() 必须被调用"
      },
      {
        "name": "智能预加载",
        "description": "根据用户输入和角色，预加载12+项内容（技能、经验、规则、目录等）",
        "key_files": [
          "v7.3-core-logic.js",
          "fusion-phase2-memory-loader.js"
        ],
        "key_rules": [],
        "status": "正常",
        "注意事项": "FusionMemoryLoader 必须被调用"
      },
      {
        "name": "统计系统",
        "description": "单次对话统计（触发规则数、违规数、触发的规则列表），显示在每次回复末尾",
        "key_files": [
          "ResponseInterceptor.js",
          "liuxin-mcp-server-unified.js",
          "monitoring-points-count.json"
        ],
        "key_rules": [
          "RULE-007",
          "IR-005"
        ],
        "status": "正常",
        "注意事项": "【终极锁定】- v7.10.14已修正监控点位332个，v7.10.13已修复累积问题，Response结束时重置，实现真正的单次对话统计，绝对不可修改",
        "显示样式": "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n📊 统计：触发 X/350条 违规 Y条\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━",
        "统计规则": {
          "统计范围": "单次对话（不是累计统计）",
          "重置时机": "每次Response结束时（方案B）",
          "去重规则": "相同的触发点在同一对话中只计算一次",
          "计数方式": "统计触发点的数量，不统计触发的次数",
          "示例说明": "同一个规则触发多次，只算1个触发点",
          "总监控点位": 350,
          "统计内容": [
            "触发规则数量（去重后）",
            "违规数量",
            "触发的规则列表（去重）"
          ]
        },
        "实现机制": {
          "存储位置": "global.currentSessionStats",
          "去重数据结构": "global.triggeredRules (Set), global.violatedRules (Set)",
          "初始化位置": "liuxin-mcp-server-unified.js的handleToolCall（仅首次）",
          "累加位置": "MCP服务器的logInterception方法",
          "重置位置": "ResponseInterceptor.intercept方法的末尾（return前）",
          "重置时机": "每次Response结束时立即重置",
          "显示时机": "Response阶段（重置前）",
          "更新时机": [
            "Pre-execution阶段",
            "Post-execution阶段",
            "Mid-execution阶段",
            "Response阶段"
          ]
        },
        "v7.10.13修复说明": {
          "问题": "同一窗口连续对话时统计累积（59→65→71），不是单次统计",
          "方案": "方案B - Response结束时重置（用户选择）",
          "修复": [
            "在ResponseInterceptor.intercept末尾（return前）添加重置逻辑",
            "删除MCP服务器中的重置逻辑，只保留初始化",
            "重置不影响当前显示，只影响下次对话"
          ],
          "效果": "每次回复显示完整对话周期统计，显示后立即重置，下次对话从0开始，实现真正的单次对话统计"
        }
      },
      {
        "name": "锁定系统",
        "description": "防止核心模块被意外修改，支持热重载",
        "key_files": [
          "locks/LockManager.js",
          "locks/lock-config.json"
        ],
        "key_rules": [],
        "status": "正常",
        "注意事项": "LockManager自身也被锁定，热重载通过fs.watch实现"
      },
      {
        "name": "配置热重载",
        "description": "修改配置文件后无需重启Cursor即可生效",
        "key_files": [
          "ConfigHotReloadManager.js",
          "locks/LockManager.js"
        ],
        "key_rules": [],
        "status": "正常 (v7.11.1升级)",
        "注意事项": "✅支持：lock-config.json、liuxin.db(清除L1缓存) ❌不支持：.js代码文件（必须重启Cursor）",
        "覆盖范围": {
          "支持热重载": [
            "locks/lock-config.json - 锁定配置",
            "liuxin.db - 数据库规则（清除规则引擎L1缓存）"
          ],
          "不支持热重载": [
            "所有.js代码文件 - 必须重启Cursor",
            "原因：Cursor MCP stdio模式限制，进程生命周期由Cursor控制"
          ]
        },
        "v7.11.1更新": "创建ConfigHotReloadManager统一管理配置热重载，HotReloadManager.js已废弃"
      },
      {
        "name": "归档系统",
        "description": "自动归档对话历史、Bug修复记录、项目快照",
        "key_files": [
          "archive-manager.js",
          "archives/"
        ],
        "key_rules": [
          "ARCHIVE-001",
          "ARCHIVE-002",
          "ARCHIVE-003"
        ],
        "status": "正常",
        "注意事项": "每次对话结束后自动触发"
      },
      {
        "name": "复述系统",
        "description": "收到用户任务后，先复述需求，再提出执行计划，询问确认",
        "key_files": [
          "ResponseInterceptor.js",
          "v7.3-core-logic.js"
        ],
        "key_rules": [
          "RULE-002",
          "IR-006"
        ],
        "status": "正常",
        "注意事项": "如果需求数量>=3，必须等待用户确认才能执行"
      }
    ]
  },
  "🐛已知问题与经验": {
    "说明": "历史上出现过的问题及解决方案，避免重复试错",
    "问题总数": 6,
    "问题列表": [
      {
        "问题": "统计一直累加不重置",
        "原因": "统计重置逻辑放在ResponseInterceptor（太晚），而不是handleToolCall（工具调用前）",
        "解决方案": "在handleToolCall开始处，使用5秒时间间隔检测新对话，重置统计",
        "版本": "v7.10.10",
        "状态": "已修复",
        "锁定": "终极锁定，绝对不可修改"
      },
      {
        "问题": "LockManager配置修改后不生效",
        "原因": "Node.js模块缓存导致",
        "解决方案": "实现热重载（fs.watch），无需重启Cursor",
        "版本": "v7.10.6",
        "状态": "已修复",
        "锁定": "是"
      },
      {
        "问题": "团队模式角色不切换",
        "原因": "MCP服务器未调用SmartPreloader.analyzeRole()",
        "解决方案": "在liuxin-mcp-server-unified.js中直接调用SmartPreloader",
        "版本": "v7.10.8",
        "状态": "已修复",
        "锁定": "否（已解锁）"
      },
      {
        "问题": "预加载数据不完整",
        "原因": "SmartPreloader未集成FusionMemoryLoader",
        "解决方案": "在SmartPreloader.generateResponse中调用fusionLoader",
        "版本": "v7.10.8",
        "状态": "已修复",
        "锁定": "否"
      },
      {
        "问题": "修改A功能时B功能也被破坏",
        "原因": "AI未遵守\"只修改指定代码\"原则",
        "解决方案": "CORE-002规则：严禁越界修改",
        "版本": "自始至终",
        "状态": "持续监控",
        "锁定": "核心规则"
      },
      {
        "问题": "同样问题反复出现",
        "原因": "上下文丢失，AI不记得之前的修复",
        "解决方案": "归档系统 + 开发经验库 + 本文档",
        "版本": "v7.10.8",
        "状态": "已修复",
        "锁定": "核心规则"
      }
    ]
  },
  "📚归档的Bug修复记录": {
    "说明": "从archives/bug-fixes/提取的历史修复记录",
    "记录总数": 0,
    "最近20条记录": []
  },
  "⚠️关键注意事项": {
    "1. 严禁越界修改": "修改B功能时，A/C/D功能的代码一个字符都不能动（CORE-002）",
    "2. 禁止降级修复": "修复问题时找到根因，禁止用低级方案替代（CORE-003）",
    "3. 统计系统终极锁定": "统计功能已反复出现问题，现已终极锁定，绝对不可修改",
    "3.1 统计显示规则": "必须使用固定样式：━━━ 📊 统计：触发 X/350条 违规 Y条 ━━━（v7.10.14已修正并扩充）",
    "3.2 统计计数规则": "单次对话统计（不累计），相同触发点只算一次（去重），统计数量不统计次数",
    "3.3 统计去重逻辑": "使用Set数据结构存储triggeredRules和violatedRules，自动去重",
    "4. 必须复述需求": "收到任务后，先复述需求，再执行（CORE-006）",
    "5. 锁定模块不可改": "locked: true的模块，除非用户明确解锁，否则不可修改",
    "6. 配置热重载已实现": "✅支持：lock-config.json、liuxin.db(清除L1缓存) ❌不支持：.js代码文件（必须重启Cursor）",
    "7. 团队模式必须调用": "SmartPreloader.analyzeRole()和FusionMemoryLoader必须被调用",
    "8. 归档系统自动触发": "每次对话结束后，ArchiveManager自动归档"
  },
  "📋AI工作流程": {
    "任务开始前": [
      "1. 读取本文档，了解系统全貌",
      "2. 检查【已知问题与经验】，看是否有相关解决方案",
      "3. 检查【模块锁定状态】，确认是否可以修改"
    ],
    "收到新任务": [
      "1. 复述用户需求（CORE-006）",
      "2. 提出执行计划",
      "3. 询问确认",
      "4. 获得确认后再执行"
    ],
    "修改代码时": [
      "1. 只修改用户明确指定的代码（CORE-002）",
      "2. 不修改其他函数/方法（即使在同一文件）",
      "3. 发现其他问题时，先报告，询问是否修复，获得授权后再改"
    ],
    "修复Bug时": [
      "1. 深度诊断找根因（CORE-003）",
      "2. 修复根因，保持原方案不变",
      "3. 禁止用低级方案替代（如：MCP失效→改用.cursorrules）",
      "4. 修复完成后，更新【开发经验库】"
    ],
    "任务完成后": [
      "1. 同步更新本文档（如果功能有变化）",
      "2. 触发归档系统（ArchiveManager）",
      "3. 如果是Bug修复，记录到【已知问题与经验】"
    ]
  },
  "🔄文档同步机制": {
    "说明": "每次系统功能修改后，必须同步更新本文档",
    "触发条件": [
      "新增功能模块",
      "修改核心逻辑",
      "新增/修改数据库规则",
      "锁定/解锁模块",
      "修复Bug",
      "升级系统版本"
    ],
    "更新方法": "重新运行 generate-system-doc.js",
    "自动化计划": "未来集成到ArchiveManager，自动触发更新"
  }
}